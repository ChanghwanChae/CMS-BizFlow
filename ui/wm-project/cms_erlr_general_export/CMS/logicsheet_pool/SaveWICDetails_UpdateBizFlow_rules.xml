<?xml version="1.0" encoding="UTF-8"?>
<hy:rulebase cache="false" context="/" disable="true" forward_chain="false" return="/" xmlns="http://www.hyfinity.com/xstore" xmlns:hy="http://www.hyfinity.com/xengine" xmlns:mvc="http://www.hyfinity.com/mvc" xmlns:ns1="http://www.hyfinity.com/xengine" xmlns:ns2="http://www.hyfinity.com/xplatform" xmlns:ns3="http://handysoft.com/webservice/ServiceConstructor" xmlns:ns4="http://service.je.wf.bf.hs.com" xmlns:ns5="http://handysoft.com/webservice/HWProcess" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xg="http://www.hyfinity.com/xgate" xmlns:xs="http://www.w3.org/2001/XMLSchema">
	<hy:workspace name="updateRequest" />
	<hy:rule base="custom" desc="Uses the BizFlow Update Process Variables service to ensure that the PV values stored in BizFlow are in sync with the values entered on the screen." disable="false" id="Update_Process_Variables_Prep" priority="10">
		<hy:head>
			<hy:result disable="false" id="create_request">
				<hy:operator>Transform</hy:operator>
				<hy:target action="transform" name="XSLT" update="append">
					<hy:params>
						<hy:param name="stylesheet" type="java.io.File">UpdatePVReq.xsl</hy:param>
						<hy:param name="from_location" type="com.hyfinity.xpath.XPath">/WorkitemContext</hy:param>
						<hy:param name="to_location" type="com.hyfinity.xpath.XPath">$updateRequest</hy:param>
					</hy:params>
				</hy:target>
			</hy:result>
		</hy:head>
		<hy:body />
	</hy:rule>
	<hy:rule base="custom" desc="" disable="false" id="Update_PVs" priority="10">
		<hy:head>
			<hy:result disable="false" id="call_bizflow">
				<hy:operator>Service</hy:operator>
				<hy:target action="Invoke" name="mvc-cms_erlr_general-HWProcessService-Access_Service" parallel="false" update="append">
					<hy:params>
						<hy:param name="from_location" type="com.hyfinity.xpath.XPath">$updateRequest</hy:param>
						<hy:param name="to_location" type="com.hyfinity.xpath.XPath">$updateRequest</hy:param>
					</hy:params>
				</hy:target>
			</hy:result>
		</hy:head>
		<hy:body>
			<hy:clause id="at least one PV modified" multiple="false">
				<hy:operator>Read</hy:operator>
				<hy:target action="eval" name="factbase">
					<hy:params>
						<hy:param name="xpath_expression" type="com.hyfinity.xpath.XPath">$updateRequest/soap:Envelope/soap:Body/ns4:updateProcessVariables/variables/ns5:item</hy:param>
					</hy:params>
				</hy:target>
			</hy:clause>
		</hy:body>
	</hy:rule>
</hy:rulebase>
